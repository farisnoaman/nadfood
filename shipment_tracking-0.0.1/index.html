<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>العسكري للنقل</title>
    <link rel="manifest" href="/manifest.json">
    
    <!-- Capture PWA install event early to ensure React doesn't miss it -->
    <script>
      window.deferredPrompt = null;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        window.deferredPrompt = e;
      });
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: {"50":"#eff6ff","100":"#dbeafe","200":"#bfdbfe","300":"#93c5fd","400":"#60a5fa","500":"#3b82f6","600":"#2563eb","700":"#1d4ed8","800":"#1e40af","900":"#1e3a8a","950":"#172554"},
              secondary: {"50":"#f8fafc","100":"#f1f5f9","200":"#e2e8f0","300":"#cbd5e1","400":"#94a3b8","500":"#64748b","600":"#475569","700":"#334155","800":"#1e293b","900":"#0f172a","950":"#020617"}
            },
            keyframes: {
              'slide-in-up': {
                'from': { transform: 'translateY(100%)' },
                'to': { transform: 'translateY(0)' },
              },
            },
            animation: {
              'slide-in-up': 'slide-in-up 0.3s ease-out',
            },
          }
        }
      }
    </script>

    <!-- Force Arabic localization for date inputs and calendar -->
    <script>
      // Set Arabic locale for date formatting and calendar display
      document.documentElement.lang = 'ar';
      document.documentElement.dir = 'rtl';
      
      // Function to set Arabic locale for date inputs
      function setArabicDateInputs() {
        const dateInputs = document.querySelectorAll('input[type="date"]');
        dateInputs.forEach(input => {
          input.lang = 'ar';
        });
      }

      // Set Arabic locale immediately and whenever new date inputs are added
      document.addEventListener('DOMContentLoaded', setArabicDateInputs);
      setArabicDateInputs();
      
      // Override date input formatting
      const originalDateInput = HTMLInputElement.prototype.setAttribute;
      HTMLInputElement.prototype.setAttribute = function(name, value) {
        if (name === 'type' && value === 'date') {
          originalDateInput.call(this, 'lang', 'ar');
        }
        return originalDateInput.call(this, name, value);
      };
      
      // Handle browser-specific date picker localization
      if (navigator.language && !navigator.language.startsWith('ar')) {
        // Override Intl.DateTimeFormat for date inputs
        const originalToLocaleDateString = Date.prototype.toLocaleDateString;
        Date.prototype.toLocaleDateString = function(locale = 'ar-SA') {
          return originalToLocaleDateString.call(this, locale);
        };
      }
      
      // Force Arabic month names in calendar widgets
      window.addEventListener('load', function() {
        setTimeout(() => {
          // Try to find and style date picker elements
          const monthLabels = document.querySelectorAll('.react-datepicker__month-select option, .react-datepicker__header select, [data-month], [aria-label*="month"]');
          monthLabels.forEach(label => {
            if (label.textContent) {
              // Map English months to Arabic
              const monthMap = {
                'January': 'يناير', 'February': 'فبراير', 'March': 'مارس',
                'April': 'أبريل', 'May': 'مايو', 'June': 'يونيو',
                'July': 'يوليو', 'August': 'أغسطس', 'September': 'سبتمبر',
                'October': 'أكتوبر', 'November': 'نوفمبر', 'December': 'ديسمبر'
              };
              const arabicMonth = monthMap[label.textContent.trim()];
              if (arabicMonth) {
                label.textContent = arabicMonth;
              }
            }
          });
          
          // Change OK buttons to موافق
          const okButtons = document.querySelectorAll('button, [role="button"]');
          okButtons.forEach(button => {
            if (button.textContent && (button.textContent.trim().toLowerCase() === 'ok' || 
                button.textContent.trim().toLowerCase() === 'confirm' ||
                button.textContent.trim().toLowerCase() === 'set' ||
                button.textContent.trim().toLowerCase() === 'apply')) {
              button.textContent = 'موافق';
            }
          });
        }, 1000);
      });
      
       // Monitor for dynamically added elements
       function setupObserver() {
         if (!document.body) {
           // Wait for body to be available
           document.addEventListener('DOMContentLoaded', setupObserver);
           return;
         }

         const observer = new MutationObserver(function(mutations) {
           mutations.forEach(function(mutation) {
             mutation.addedNodes.forEach(function(node) {
               if (node.nodeType === 1) { // Element node
                 setArabicDateInputs();

                 // Check if it's a date picker button
                 if (node.textContent && (node.textContent.includes('OK') || node.textContent.includes('Ok') || node.textContent.includes('ok'))) {
                   node.textContent = node.textContent.replace(/ok/gi, 'موافق');
                 }
               }
             });
           });
         });

         observer.observe(document.body, {
           childList: true,
           subtree: true
         });
       }

       setupObserver();
    </script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
      body {
        font-family: 'Cairo', sans-serif;
        -webkit-tap-highlight-color: transparent;
      }
    </style>
    <!-- Clear service worker in development -->
    <script>
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        // Clear any existing service workers in development
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(registrations => {
            registrations.forEach(registration => {
              registration.unregister();
              console.log('Development: Unregistered service worker');
            });
          });
          
          // Clear caches
          if ('caches' in window) {
            caches.keys().then(cacheNames => {
              cacheNames.forEach(cacheName => {
                caches.delete(cacheName);
                console.log('Development: Deleted cache:', cacheName);
              });
            });
          }
        }
      }
    </script>
    
    <script type="importmap">
{
  "imports": {
    "jspdf": "https://esm.sh/jspdf@2.5.1",
    "html2canvas": "https://esm.sh/html2canvas@1.4.1",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>